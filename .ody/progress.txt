2026-01-29: Added --provider/--model args to init to persist optional config fields; marked PRD complete.
2026-02-03: Added basic Bun tests for Test task (Test 1/2) and marked PRD entry complete.
2026-02-03: Added `ody plan` command stub with console message; marked PRD entry complete.
2026-02-03: Implemented interactive `ody plan` prompts using @clack/prompts and console output; marked PRD entry complete.
2026-02-05: Fixed proc.kill(0) zombie process bug — replaced proc.kill(0) with proc.kill() + await proc.exited in run.ts loop mode, removed unnecessary proc.kill(exitCode) in run.ts once mode, replaced proc.kill(0) with proc.kill() in plan.ts; marked PRD entry complete.
2026-02-05: Fixed stderr pipe deadlock — changed stdio from ['ignore','pipe','pipe'] to ['ignore','pipe','inherit'] in run.ts and plan.ts so stderr flows directly to the terminal instead of filling an unread pipe buffer; marked PRD entry complete.
2026-02-05: Fixed maxIterations: 0 bug — updated for-loop in run.ts to treat 0 as infinite (`maxIterations === 0 || i < maxIterations`), added `.int().nonnegative()` constraints to zod schema in config.ts; marked PRD entry complete.
2026-02-05: Fixed silent swallowing of non-Error exceptions — added else branches to all 4 catch blocks (config.ts, init.ts, run.ts x2) so non-Error thrown values (strings, objects, ZodError) are logged via String(err) and trigger process.exit(1) instead of being silently ignored; marked PRD entry complete.
2026-02-05: Made Claude --dangerously-skip-permissions flag configurable — added optional `skipPermissions` boolean (default true) to zod config schema, added confirm prompt during `ody init` when backend is claude, updated claude.ts to conditionally include the flag based on config; marked PRD entry complete.
2026-02-05: Added plan iteration loop — wrapped the entire plan flow in a while loop with a "Would you like to add another plan?" confirm prompt after each iteration; user can create multiple plans in one session or decline to exit gracefully; also handles cancel (Ctrl+C) at the confirm prompt; marked PRD entry complete.
2026-02-05: Added verbose stderr logging to run command — when --verbose is passed, stderr is piped instead of inherited and drained concurrently via an async IIFE that logs each chunk through logger.warn, preventing buffer deadlock while keeping stderr as 'inherit' when verbose is off; marked PRD entry complete.
2026-02-05: Added verbose stderr logging to plan command — mirrored the run command pattern: when --verbose is passed, stderr stdio changes from 'inherit' to 'pipe' and is drained concurrently via an async IIFE that logs each chunk through logger.warn; stderr remains 'inherit' when verbose is off; stdout completion marker detection is unaffected; marked PRD entry complete.
2026-02-10: Completed task 'Add Unit Tests for Util Modules' - Created 3 test files (constants.test.ts, stream.test.ts, inputPrompt.test.ts) with 21 passing tests covering all util modules. All tests pass via 'bun test packages/cli/src/util'.
2026-02-10: Completed task - Configurable Tasks Directory. Added tasksDir config option with default '.ody/tasks', updated LOOP_PROMPT and PLAN_PROMPT to use dynamic path substitution.
2026-02-10: Added label filter flag (-l/--label) to run command with task filtering and dry-run integration
2026-02-10: Removed confirmation prompt from plan command — removed the box() display and confirm() prompt that asked "Proceed with these plan details?" after entering a task description. Plan generation now starts immediately after the user submits their description, reducing friction. Cleaned up unused imports (box, cancel).
2026-02-10: Added `ody config` command — created packages/cli/src/cmd/config.ts that displays current configuration from .ody/ody.json using Config.all(), registered it as a subcommand in index.ts. Handles missing config gracefully with a helpful message.
2026-02-10: Added --iterations/-i flag to run command — allows overriding maxIterations config at invocation time. Validates input as non-negative integer, supports 0 for unlimited. No effect in --once mode. All validation commands pass.
2026-02-10: Added PTY-based completion detection to --once mode — replaced inherited stdio with Bun.Terminal PTY API in run.ts so the <woof>COMPLETE</woof> marker is detected and the process is killed automatically, while preserving full interactive TTY behavior for the child process.
2026-02-10: Added `plan list` subcommand — restructured plan.ts to support subcommands using citty's subCommands pattern. Existing plan creation logic preserved as default behavior (`ody plan`) and also available as `ody plan create`. New `list` subcommand reads .code-task.md files from the tasks directory, parses YAML frontmatter, and displays pending tasks with titles and filenames. Handles missing directory and no-pending-tasks cases gracefully.
